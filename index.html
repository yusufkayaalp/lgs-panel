<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EGE KAYAALP | LGS MASTER V37</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#f39c12">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Montserrat:wght@900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>

    <style>
        :root { --numeric: #3498db; --verbal: #f39c12; --focus: #9b59b6; --mola: #2ecc71; --bg: #f4f7f6; --card: #ffffff; --text: #2d3436; }
        
        body { font-family: 'Poppins', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px 15px 130px 15px; display: flex; justify-content: center; }
        .app-container { width: 100%; max-width: 450px; display: flex; flex-direction: column; gap: 15px; }
        .card { background: var(--card); border-radius: 22px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); position: relative; }
        
        /* Header */
        .top-btns { position: absolute; top: 15px; right: 15px; display: flex; gap: 8px; z-index: 100; }
        .icon-btn { background: #eee; border: none; padding: 8px 12px; border-radius: 10px; font-size: 0.7rem; font-weight: 800; cursor: pointer; }
        .icon-btn.active { background: #2ecc71; color: white; }
        .user-name { font-family: 'Montserrat'; font-size: 1.8rem; text-align: center; margin: 0; color: #f39c12 !important; text-transform: uppercase; }
        .quote { font-size: 0.7rem; color: #95a5a6; text-align: center; margin-top: 5px; font-style: italic; }

        /* Timer */
        .timer-display { font-size: 5.5rem; font-weight: 800; text-align: center; margin: 10px 0; font-variant-numeric: tabular-nums; letter-spacing: -2px; }
        .mode-indicator { background: #f1f2f6; padding: 5px 15px; border-radius: 20px; font-size: 0.7rem; font-weight: 800; display: inline-block; margin-bottom: 10px; border: 2px solid var(--numeric); text-transform: uppercase; }

        /* Fixed Action Bar */
        .action-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
            padding: 20px; box-shadow: 0 -10px 30px rgba(0,0,0,0.08);
            display: flex; justify-content: center; align-items: center; gap: 15px;
            z-index: 9999; border-top-left-radius: 30px; border-top-right-radius: 30px;
        }

        .main-btn { 
            flex: 4; height: 70px; background: #f39c12; color: white; border: none; border-radius: 20px; 
            font-size: 1.4rem; font-weight: 900; text-transform: uppercase; cursor: pointer;
            box-shadow: 0 8px 25px rgba(243, 156, 18, 0.3); display: flex !important; align-items: center; justify-content: center;
        }
        .reset-btn {
            flex: 1; height: 70px; background: #eee; color: #7f8c8d; border: none; border-radius: 20px;
            font-size: 1.5rem; cursor: pointer; display: flex !important; align-items: center; justify-content: center;
        }

        /* Mode & Custom */
        .mode-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin: 10px 0; }
        .mode-btn { background: #eee; border: none; padding: 12px 5px; border-radius: 12px; font-size: 0.65rem; font-weight: 800; color: #7f8c8d; cursor: pointer; text-transform: uppercase; }
        .mode-btn.active.num { background: var(--numeric); color: white; }
        .mode-btn.active.ver { background: var(--verbal); color: white; }
        .mode-btn.active.foc { background: var(--focus); color: white; }
        .mode-btn.active.brk { background: var(--mola); color: white; }
        
        .custom-area { display: flex; gap: 10px; margin-top: 10px; padding-top: 10px; border-top: 1px dashed #eee; }
        .custom-input { width: 70px; border-radius: 12px; border: 1.5px solid #eee; padding: 10px; text-align: center; font-weight: 800; outline: none; }
        .custom-set-btn { flex: 1; background: #2d3436; color: white; border: none; border-radius: 12px; font-weight: 800; font-size: 0.75rem; cursor: pointer; }

        /* Stats */
        .dash-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .dash-item { background: #f8f9fa; padding: 12px 5px; border-radius: 15px; text-align: center; border: 1px solid rgba(0,0,0,0.02); }
        .dash-label { font-size: 0.55rem; color: #95a5a6; display: block; font-weight: 700; text-transform: uppercase; }
        .dash-val { font-size: 0.9rem; font-weight: 800; display: block; }

        /* Q-Modal */
        #q-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 10000; padding: 20px; backdrop-filter: blur(10px); }
        .modal-content { background: white; padding: 30px; border-radius: 30px; width: 100%; max-width: 320px; text-align: center; }
        .q-input { width: 100%; padding: 15px; margin: 20px 0; border-radius: 15px; border: 2px solid #eee; font-size: 2.5rem; text-align: center; outline: none; font-weight: 800; }

        .todo-item { display: flex; align-items: center; gap: 10px; background: #f8f9fa; padding: 12px; border-radius: 15px; margin-bottom: 8px; }
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 10px; }
        .cal-day { font-size: 0.6rem; text-align: center; padding: 8px 0; background: #f9f9f9; border-radius: 8px; color: #bdc3c7; font-weight: 700; }
        .cal-day.work { background: #e3f2fd; color: #3498db; }
        .cal-day.today { border: 2px solid #f39c12; color: #f39c12; font-weight: 900; }
    </style>
</head>
<body>

    <div id="q-modal">
        <div class="modal-content">
            <h2 id="modal-title" style="margin:0">Oturum Bitti!</h2>
            <p style="color:#666">Ka√ß soru √ß√∂zd√ºn?</p>
            <input type="number" id="q-count" class="q-input" placeholder="0" inputmode="numeric">
            <button onclick="submitQuestions()" class="main-btn" style="height:60px; width:100%">KAYDET</button>
        </div>
    </div>

    <div class="app-container">
        <div class="card">
            <div class="top-btns">
                <button class="icon-btn" id="cloud-btn" onclick="toggleSyncPanel()">‚òÅÔ∏è</button>
                <button class="icon-btn" onclick="toggleLang()">EN</button>
            </div>
            <h1 class="user-name">EGE KAYAALP</h1>
            <p id="quote-text" class="quote">"Gelecek, bug√ºnden hazƒ±rlananlara aittir."</p>
            
            <div id="sync-panel" style="display:none; margin-top:15px; border-top:1px solid #eee; padding-top:15px;">
                <input type="password" id="sync-key" style="width:100%; padding:12px; border-radius:10px; border:1px solid #ddd; margin-bottom:10px; box-sizing:border-box" placeholder="Sync ID...">
                <button onclick="connectCloud()" class="icon-btn" style="width:100%; background:var(--numeric); color:white; padding:12px;">BULUTA BAƒûLAN</button>
            </div>
        </div>

        <div class="card" style="text-align:center">
            <div id="mode-display" class="mode-indicator">SAYISAL OTURUMU</div>
            <div class="timer-display" id="timer">80:00</div>
            
            <div class="mode-grid">
                <button class="mode-btn active num" onclick="setMode(80, 'NUM', this)">Sayƒ±sal</button>
                <button class="mode-btn ver" onclick="setMode(75, 'VER', this)">S√∂zel</button>
                <button class="mode-btn foc" onclick="setMode(25, 'FOC', this)">Odak</button>
                <button class="mode-btn brk" onclick="setMode(5, 'BRK', this)">Mola</button>
            </div>

            <div class="custom-area">
                <input type="number" id="custom-min" class="custom-input" placeholder="Dk">
                <button onclick="setCustom()" class="custom-set-btn" id="btn-custom">S√úREYƒ∞ AYARLA</button>
            </div>
        </div>

        <div class="card">
            <div style="font-size:0.75rem; font-weight:800; margin-bottom:12px; color:#3498db" id="lbl-dash">BUG√úNK√ú PERFORMANSIN</div>
            <div class="dash-grid">
                <div class="dash-item"><span class="dash-label">Sayƒ±sal</span><span class="dash-val" id="today-num">0d</span></div>
                <div class="dash-item"><span class="dash-label">Soru</span><span class="dash-val" id="today-q-num">0</span></div>
                <div class="dash-item"><span class="dash-label">Hƒ±z</span><span class="dash-val" id="today-speed-num">0s</span></div>
                <div class="dash-item"><span class="dash-label">S√∂zel</span><span class="dash-val" id="today-ver">0d</span></div>
                <div class="dash-item"><span class="dash-label">Soru</span><span class="dash-val" id="today-q-ver">0</span></div>
                <div class="dash-item"><span class="dash-label">Hƒ±z</span><span class="dash-val" id="today-speed-ver">0s</span></div>
                <div class="dash-item"><span class="dash-label">Odak</span><span class="dash-val" id="today-foc">0d</span></div>
                <div class="dash-item"><span class="dash-label">Seri</span><span class="dash-val" id="streak">0</span></div>
                <div class="dash-item"><span class="dash-label">Mola</span><span class="dash-val" id="today-brk">0d</span></div>
            </div>
        </div>

        <div class="card">
            <div style="font-size:0.7rem; font-weight:800; margin-bottom:10px">HAFTALIK GELƒ∞≈ûƒ∞M</div>
            <div style="height:150px;"><canvas id="chart"></canvas></div>
        </div>

        <div class="card">
            <div style="font-size:0.7rem; font-weight:800; margin-bottom:10px">√áALI≈ûMA TAKVƒ∞Mƒ∞</div>
            <div class="calendar-grid" id="calendar-body"></div>
        </div>

        <div class="card">
            <div style="display:flex; gap:10px; margin-bottom:10px;">
                <input type="text" id="task-in" style="flex:1; border:none; background:#f1f2f6; padding:12px; border-radius:12px; outline:none" placeholder="Hedef ekle...">
                <button onclick="addTask()" style="background:#3498db; color:white; border:none; width:45px; border-radius:12px; font-weight:bold; cursor:pointer">+</button>
            </div>
            <div id="task-list"></div>
        </div>
    </div>

    <div class="action-bar">
        <button class="reset-btn" onclick="resetTimer()" title="Sƒ±fƒ±rla">üîÑ</button>
        <button class="main-btn" id="start-btn" onclick="toggleTimer()">BA≈ûLAT</button>
    </div>

    <script>
        let db = JSON.parse(localStorage.getItem('ege_v37_db')) || { num: {}, ver: {}, foc: {}, brk: {}, q_num: {}, q_ver: {}, tasks: [], streak: 0, lastDate: "" };
        let currentLang = 'TR', timeLeft = 80 * 60, isRunning = false, timerId = null, endTime = null, curMins = 80, selectedCat = 'NUM', myChart = null;
        let cloudRef = null;

        function getToday() { return new Date().toLocaleDateString('sv-SE'); }

        function playChime() {
            try {
                const ctx = new (window.AudioContext || window.webkitAudioContext)();
                const play = (f, s, d) => {
                    const o = ctx.createOscillator(); const g = ctx.createGain();
                    o.type = 'triangle'; o.frequency.setValueAtTime(f, s);
                    g.gain.setValueAtTime(0, s); g.gain.linearRampToValueAtTime(0.3, s + 0.1);
                    g.gain.exponentialRampToValueAtTime(0.01, s + d);
                    o.connect(g); g.connect(ctx.destination);
                    o.start(s); o.stop(s + d);
                };
                play(554.37, ctx.currentTime, 0.8); play(440.00, ctx.currentTime + 0.5, 0.8);
            } catch(e) {}
        }

        function toggleTimer() {
            const btn = document.getElementById('start-btn');
            if (isRunning) {
                isRunning = false; clearInterval(timerId);
                timeLeft = Math.max(0, Math.round((endTime - Date.now()) / 1000));
                btn.textContent = "DEVAM ET";
            } else {
                isRunning = true; endTime = Date.now() + (timeLeft * 1000);
                timerId = setInterval(() => {
                    timeLeft = Math.max(0, Math.round((endTime - Date.now()) / 1000));
                    document.getElementById('timer').textContent = `${Math.floor(timeLeft/60).toString().padStart(2,'0')}:${(timeLeft%60).toString().padStart(2,'0')}`;
                    if (timeLeft <= 0) { clearInterval(timerId); isRunning = false; finish(); }
                }, 250);
                btn.textContent = "DURAKLAT";
            }
        }

        function finish() {
            const day = getToday();
            db[selectedCat.toLowerCase()][day] = (db[selectedCat.toLowerCase()][day] || 0) + curMins;
            if(selectedCat !== 'BRK' && db.lastDate !== day) { db.streak++; db.lastDate = day; }
            save(); playChime();
            if(selectedCat === 'NUM' || selectedCat === 'VER') {
                document.getElementById('q-modal').style.display = 'flex';
                document.getElementById('q-count').focus();
            } else { resetTimer(); }
        }

        function submitQuestions() {
            const day = getToday();
            const val = parseInt(document.getElementById('q-count').value) || 0;
            db['q_' + selectedCat.toLowerCase()][day] = (db['q_' + selectedCat.toLowerCase()][day] || 0) + val;
            document.getElementById('q-modal').style.display = 'none';
            document.getElementById('q-count').value = '';
            save(); resetTimer();
        }

        function setMode(mins, cat, btn) {
            isRunning = false; clearInterval(timerId);
            timeLeft = mins * 60; curMins = mins; selectedCat = cat;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active', 'num', 'ver', 'foc', 'brk'));
            btn.classList.add('active', cat.toLowerCase());
            
            const color = getComputedStyle(document.documentElement).getPropertyValue('--' + cat.toLowerCase()).trim();
            const sBtn = document.getElementById('start-btn');
            sBtn.style.background = color;
            sBtn.style.boxShadow = `0 8px 25px ${color}55`;
            sBtn.textContent = "BA≈ûLAT";
            
            const mDisp = document.getElementById('mode-display');
            mDisp.style.borderColor = color;
            mDisp.textContent = cat === 'NUM' ? "SAYISAL OTURUMU" : cat === 'VER' ? "S√ñZEL OTURUMU" : cat === 'FOC' ? "ODAKLANMA" : "MOLA";
            document.getElementById('timer').textContent = `${mins.toString().padStart(2,'0')}:00`;
        }

        function setCustom() {
            const val = parseInt(document.getElementById('custom-min').value);
            if(val > 0) {
                timeLeft = val * 60; curMins = val;
                document.getElementById('timer').textContent = `${val.toString().padStart(2,'0')}:00`;
                document.getElementById('start-btn').textContent = "BA≈ûLAT";
                isRunning = false; clearInterval(timerId);
            }
        }

        function resetTimer() {
            isRunning = false; clearInterval(timerId);
            timeLeft = curMins * 60;
            document.getElementById('timer').textContent = `${curMins.toString().padStart(2,'0')}:00`;
            document.getElementById('start-btn').textContent = "BA≈ûLAT";
        }

        function save() {
            localStorage.setItem('ege_v37_db', JSON.stringify(db));
            if(cloudRef) cloudRef.set(db);
            updateUI();
        }

        function updateUI() {
            const day = getToday();
            const tN = db.num[day] || 0, tV = db.ver[day] || 0;
            const qN = db.q_num[day] || 0, qV = db.q_ver[day] || 0;
            
            document.getElementById('today-num').textContent = tN + "d";
            document.getElementById('today-ver').textContent = tV + "d";
            document.getElementById('today-foc').textContent = (db.foc[day] || 0) + "d";
            document.getElementById('today-brk').textContent = (db.brk[day] || 0) + "d";
            document.getElementById('today-q-num').textContent = qN;
            document.getElementById('today-q-ver').textContent = qV;
            document.getElementById('streak').textContent = db.streak;
            document.getElementById('today-speed-num').textContent = qN > 0 ? ((tN * 60) / qN).toFixed(0) + "s" : "0s";
            document.getElementById('today-speed-ver').textContent = qV > 0 ? ((tV * 60) / qV).toFixed(0) + "s" : "0s";

            const list = document.getElementById('task-list'); list.innerHTML = '';
            (db.tasks || []).forEach((t, i) => {
                const d = document.createElement('div'); d.className = 'todo-item';
                d.innerHTML = `<input type="checkbox" ${t.done?'checked':''} onchange="db.tasks[${i}].done=!db.tasks[${i}].done;save()"> <span style="${t.done?'text-decoration:line-through;opacity:0.5':''}">${t.txt}</span>`;
                list.appendChild(d);
            });
            drawChart(); renderCalendar();
        }

        function drawChart() {
            const ctx = document.getElementById('chart').getContext('2d');
            const labels = [], nD = [], vD = [];
            for(let i=6; i>=0; i--) {
                const d = new Date(); d.setDate(d.getDate()-i); const k = d.toLocaleDateString('sv-SE');
                labels.push(d.toLocaleDateString('tr-TR', {weekday:'short'}));
                nD.push(db.num[k]||0); vD.push(db.ver[k]||0);
            }
            if(myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'bar', data: { labels, datasets: [{ label: 'N', data: nD, backgroundColor: '#3498db', borderRadius: 5 }, { label: 'V', data: vD, backgroundColor: '#f39c12', borderRadius: 5 }]},
                options: { maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { display: false }, x: { grid: { display: false } } } }
            });
        }

        function renderCalendar() {
            const body = document.getElementById('calendar-body'); body.innerHTML = '';
            const now = new Date(); const todayKey = getToday();
            const daysInMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
            for(let i=1; i<=daysInMonth; i++) {
                const k = now.getFullYear() + '-' + String(now.getMonth() + 1).padStart(2, '0') + '-' + String(i).padStart(2, '0');
                const hasData = db.num[k] || db.ver[k];
                const el = document.createElement('div'); el.className = `cal-day ${hasData ? 'work' : ''} ${k === todayKey ? 'today' : ''}`; el.textContent = i;
                body.appendChild(el);
            }
        }

        function addTask() { const inp = document.getElementById('task-in'); if(inp.value) { db.tasks.push({txt: inp.value, done: false}); save(); inp.value = ''; } }
        function toggleSyncPanel() { const p = document.getElementById('sync-panel'); p.style.display = p.style.display === 'block' ? 'none' : 'block'; }
        
        function connectCloud() {
            const key = document.getElementById('sync-key').value.trim();
            if (key.length < 4) return;
            cloudRef = firebase.database().ref('users/' + btoa(key));
            cloudRef.on('value', (snap) => { if (snap.exists()) { db = snap.val(); save(); } });
            document.getElementById('cloud-btn').classList.add('active');
            toggleSyncPanel();
        }

        updateUI();
    </script>
</body>
</html>
