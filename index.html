<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ege Kayaalp | Focus Pro V14</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#f39c12">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Montserrat:wght@900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        :root { --primary: #f39c12; --bg: #f4f7f6; --card: #ffffff; --text-dark: #2d3436; --accent: #3498db; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text-dark); margin: 0; padding: 15px; display: flex; justify-content: center; min-height: 100vh; }
        .app-container { width: 100%; max-width: 480px; display: flex; flex-direction: column; gap: 15px; }
        .card { background: var(--card); border-radius: 24px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); }
        
        .user-name { font-family: 'Montserrat', sans-serif; font-weight: 900; font-size: 1.8rem; text-align: center; margin: 0; text-transform: uppercase; }
        .user-name span { color: var(--primary); }
        .timer-display { font-size: 6.5rem; font-weight: 800; text-align: center; margin: 10px 0; color: var(--text-dark); font-variant-numeric: tabular-nums; }
        
        .mode-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 12px; }
        .mode-btn { background: #f8f9fa; border: 1px solid #eee; padding: 12px; border-radius: 16px; cursor: pointer; font-weight: 600; color: #636e72; font-family: 'Poppins'; transition: 0.2s; }
        .mode-btn.active { background: #fff; color: var(--primary); border-color: var(--primary); box-shadow: 0 4px 12px rgba(243, 156, 18, 0.15); }
        
        /* Custom Timer Input Area */
        .custom-timer-row { display: flex; gap: 10px; margin-bottom: 20px; align-items: center; justify-content: center; }
        .custom-input { width: 80px; padding: 10px; border-radius: 12px; border: 1px solid #eee; background: #f8f9fa; text-align: center; font-weight: 600; outline: none; font-family: 'Poppins'; }
        .custom-set-btn { background: var(--text-dark); color: white; border: none; padding: 10px 15px; border-radius: 12px; cursor: pointer; font-size: 0.8rem; font-weight: 600; }
        
        .main-btn { width: 100%; padding: 18px; border-radius: 18px; border: none; font-size: 1.2rem; font-weight: 800; cursor: pointer; background: var(--primary); color: white; box-shadow: 0 6px 15px rgba(243, 156, 18, 0.2); transition: 0.3s; }
        .main-btn:active { transform: scale(0.98); }
        
        .todo-item { display: flex; align-items: center; gap: 10px; padding: 10px 0; border-bottom: 1px solid #f8f9fa; }
        .todo-item input[type="checkbox"] { width: 18px; height: 18px; accent-color: var(--primary); }
    </style>
</head>
<body>

    <div class="app-container" id="main-app">
        <div class="card" style="text-align: center;">
            <h1 class="user-name">EGE <span>KAYAALP</span></h1>
            <div id="quote-text" style="font-size:0.85rem; font-style:italic; color:#636e72; margin-top:5px;">"Your hard work will pay off."</div>
        </div>

        <div class="card" style="text-align: center;">
            <div class="timer-display" id="timer">25:00</div>
            <div id="mode-display" style="font-size:0.85rem; color:#636e72; font-weight: 600; letter-spacing: 1px;">FOCUS SESSION</div>
        </div>

        <div class="card">
            <div class="mode-grid">
                <button class="mode-btn active" onclick="setMode(25, 'FOCUS SESSION', this)">Focus</button>
                <button class="mode-btn" onclick="setMode(5, 'SHORT BREAK', this)">Break</button>
                <button class="mode-btn" onclick="setMode(75, 'VERBAL SESSION', this)">Verbal</button>
                <button class="mode-btn" onclick="setMode(80, 'NUMERIC SESSION', this)">Numeric</button>
            </div>
            
            <div class="custom-timer-row">
                <input type="number" id="custom-min" class="custom-input" placeholder="Min" min="1" max="180">
                <button onclick="setCustomTime()" class="custom-set-btn">SET CUSTOM</button>
            </div>

            <button class="main-btn" id="start-btn" onclick="toggleTimer()">START</button>
            <div style="text-align: center; margin-top: 15px;">
                <span onclick="resetTimer()" style="color: #999; font-size: 0.75rem; cursor: pointer; text-decoration: underline;">Reset Timer</span>
            </div>
        </div>

        <div class="card">
            <div style="font-size:0.95rem; font-weight:800; margin-bottom:12px;">Daily Targets</div>
            <div style="display:flex; gap:8px; margin-bottom:15px;">
                <input type="text" id="task-in" style="flex:1; background:#f8f9fa; border:1px solid #eee; padding:12px; border-radius:12px; outline:none;" placeholder="New goal...">
                <button onclick="addTask()" style="background:var(--accent); border:none; color:white; padding:0 15px; border-radius:12px; cursor:pointer; font-weight:bold;">+</button>
            </div>
            <div id="task-list"></div>
        </div>

        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <span style="font-weight:800;">Weekly Stats</span>
                <span style="font-size:1.5rem; font-weight:800; color:var(--primary);" id="week-total">0</span>
            </div>
            <div style="height:150px;"><canvas id="chart"></canvas></div>
        </div>
    </div>

    <audio id="beep" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg"></audio>

    <script>
        // Service Worker for PWA
        if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }

        // Local Storage Database
        let db = JSON.parse(localStorage.getItem('ege_focus_data')) || { stats: {}, tasks: [] };
        
        let timeLeft = 25 * 60;
        let isRunning = false;
        let timerId = null;
        let endTime = null;
        let myChart = null;

        const quotes = [
            "Believe in yourself.",
            "Focus determines your reality.",
            "Success is earned, not given.",
            "Keep pushing Ege, you're doing great!",
            "Study now, be a champion later.",
            "Small steps every day lead to big results."
        ];

        function toggleTimer() {
            const btn = document.getElementById('start-btn');
            if (isRunning) {
                isRunning = false; clearInterval(timerId);
                timeLeft = Math.max(0, Math.round((endTime - Date.now()) / 1000));
                btn.textContent = "RESUME";
                btn.style.background = "var(--accent)";
            } else {
                isRunning = true;
                endTime = Date.now() + (timeLeft * 1000);
                timerId = setInterval(update, 100);
                btn.textContent = "STOP";
                btn.style.background = "#e74c3c";
            }
            changeQuote();
        }

        function update() {
            const remain = Math.max(0, Math.round((endTime - Date.now()) / 1000));
            if (remain !== timeLeft) {
                timeLeft = remain;
                const m = Math.floor(timeLeft / 60); const s = timeLeft % 60;
                document.getElementById('timer').textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
                if (timeLeft <= 0) { clearInterval(timerId); complete(); }
            }
        }

        function complete() {
            const mode = document.getElementById('mode-display').textContent;
            if (!mode.includes("BREAK")) {
                const day = new Date().toISOString().split('T')[0];
                db.stats[day] = (db.stats[day] || 0) + 1;
                saveDB();
            }
            document.getElementById('beep').play();
            alert("Great work Ege! Session complete.");
            resetTimer();
        }

        function setMode(mins, label, btn) {
            isRunning = false; clearInterval(timerId);
            timeLeft = mins * 60;
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');
            document.getElementById('mode-display').textContent = label;
            document.getElementById('timer').textContent = `${mins.toString().padStart(2,'0')}:00`;
            document.getElementById('start-btn').textContent = "START";
            document.getElementById('start-btn').style.background = "var(--primary)";
        }

        function setCustomTime() {
            const val = document.getElementById('custom-min').value;
            if(val > 0 && val <= 180) {
                setMode(parseInt(val), 'CUSTOM FOCUS SESSION', null);
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            } else {
                alert("Please enter minutes between 1-180.");
            }
        }

        function resetTimer() { 
            const activeBtn = document.querySelector('.mode-btn.active');
            if(activeBtn) activeBtn.click(); else setMode(25, 'FOCUS SESSION', null);
        }

        function changeQuote() { 
            document.getElementById('quote-text').textContent = `"${quotes[Math.floor(Math.random()*quotes.length)]}"`; 
        }

        function saveDB() {
            localStorage.setItem('ege_focus_data', JSON.stringify(db));
            updateUI();
        }

        function updateUI() {
            const list = document.getElementById('task-list');
            list.innerHTML = '';
            (db.tasks || []).forEach((t, i) => {
                const div = document.createElement('div'); div.className = 'todo-item';
                div.innerHTML = `<input type="checkbox" ${t.done?'checked':''} onchange="toggleTask(${i})"> 
                                <span style="${t.done?'text-decoration:line-through;opacity:0.5':''}">${t.txt}</span>`;
                list.appendChild(div);
            });
            updateChart();
        }

        function updateChart() {
            const ctx = document.getElementById('chart').getContext('2d');
            const labels = []; const data = []; let total = 0;
            for(let i=6; i>=0; i--) {
                const d = new Date(); d.setDate(d.getDate()-i);
                const k = d.toISOString().split('T')[0];
                labels.push(d.toLocaleDateString('en-US', {weekday: 'short'}));
                const v = db.stats[k] || 0;
                data.push(v); total += v;
            }
            document.getElementById('week-total').textContent = total;
            if(myChart) myChart.destroy();
            myChart = new Chart(ctx, {
                type: 'bar', data: { labels, datasets: [{ data, backgroundColor: '#f39c12', borderRadius: 8 }] },
                options: { maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { display: false, beginAtZero: true }, x: { grid: { display: false } } } }
            });
        }

        function addTask() {
            const inp = document.getElementById('task-in');
            if(!inp.value.trim()) return;
            db.tasks.push({ txt: inp.value, done: false });
            saveDB();
            inp.value = '';
        }

        function toggleTask(i) {
            db.tasks[i].done = !db.tasks[i].done;
            saveDB();
        }

        // Initialize
        updateUI();
        changeQuote();
    </script>
</body>
</html>
